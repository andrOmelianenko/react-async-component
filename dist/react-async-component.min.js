"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),PropTypes=_interopDefault(require("prop-types")),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},createAsyncContext=function(){var e=0,t={},n={};return{getNextId:function(){return e+=1},resolved:function(e){t[e]=!0},failed:function(e,t){n[e]=t},getState:function(){return{resolved:Object.keys(t).reduce(function(e,t){return Object.assign(e,defineProperty({},t,!0))},{}),errors:n}}}},AsyncComponentProvider=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"componentWillMount",value:function(){this.asyncContext=this.props.asyncContext||createAsyncContext(),this.rehydrateState=this.props.rehydrateState}},{key:"getChildContext",value:function(){var e=this;return{asyncComponents:{getNextId:this.asyncContext.getNextId,resolved:this.asyncContext.resolved,failed:this.asyncContext.failed,shouldRehydrate:function(t){var n=e.rehydrateState.resolved[t];return delete e.rehydrateState.resolved[t],n},getError:function(t){return e.rehydrateState.errors&&e.rehydrateState.errors[t]}}}}},{key:"render",value:function(){return React__default.Children.only(this.props.children)}}]),t}(React.Component);AsyncComponentProvider.propTypes={children:PropTypes.node.isRequired,asyncContext:PropTypes.shape({getNextId:PropTypes.func.isRequired,resolved:PropTypes.func.isRequired,failed:PropTypes.func.isRequired,getState:PropTypes.func.isRequired}),rehydrateState:PropTypes.shape({resolved:PropTypes.object})},AsyncComponentProvider.defaultProps={asyncContext:void 0,rehydrateState:{resolved:{}}},AsyncComponentProvider.childContextTypes={asyncComponents:PropTypes.shape({getNextId:PropTypes.func.isRequired,resolved:PropTypes.func.isRequired,failed:PropTypes.func.isRequired,shouldRehydrate:PropTypes.func.isRequired,getError:PropTypes.func.isRequired}).isRequired};var validSSRModes=["resolve","defer","boundary"];function asyncComponent(e){var t,n,o=e.name,r=e.resolve,s=e.autoResolveES2015Default,i=void 0===s||s,u=e.serverMode,a=void 0===u?"resolve":u,l=e.LoadingComponent,c=e.ErrorComponent;if(-1===validSSRModes.indexOf(a))throw new Error("Invalid serverMode provided to asyncComponent");var p=["node","browser"].indexOf(e.env)>-1?e.env:"undefined"==typeof window?"node":"browser",d={id:null,module:null,error:null,resolver:null,resolving:!1,asyncComponents:null,asyncComponentsAncestor:null};return n=t=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),createClass(t,[{key:"getChildContext",value:function(){return{asyncComponentsAncestor:null==d.asyncComponents?null:{isBoundary:"boundary"===a}}}},{key:"componentWillMount",value:function(){null!=this.context.asyncComponents&&(d.asyncComponents=this.context.asyncComponents,d.asyncComponentsAncestor=this.context.asyncComponentsAncestor,d.id||(d.id=this.context.asyncComponents.getNextId()))}},{key:"bootstrap",value:function(){var e=this,t=function(){return e.resolveModule().then(function(e){return void 0!==e&&void 0})};if("browser"===p){var n=d.asyncComponents,o=n.shouldRehydrate,r=(0,n.getError)(d.id);return r?(d.error=r,!1):!!o(d.id)&&t()}var s=null!=d.asyncComponentsAncestor&&d.asyncComponentsAncestor.isBoundary;return"defer"!==a&&!s&&t()}},{key:"componentDidMount",value:function(){null!=d.module||null!=d.error||d.resolving||"undefined"==typeof window||this.resolveModule()}},{key:"resolveModule",value:function(){var e=this;return function(){if(null==d.resolver){d.resolving=!0;try{d.resolver=Promise.resolve(r())}catch(e){d.resolver=Promise.reject(e)}}return d.resolver}().then(function(e){return null!=d.asyncComponents&&d.asyncComponents.resolved(d.id),d.module=e,d.error=null,d.resolving=!1,e}).catch(function(e){var t={message:e.message,stack:e.stack};null!=d.asyncComponents&&d.asyncComponents.failed(d.id,t),d.error=t,d.resolving=!1,c||console.error(t)}).then(function(t){if(!e.unmounted)return e.context.reactAsyncBootstrapperRunning||"browser"!==p||e.forceUpdate(),t})}},{key:"retryResolvingModule",value:function(){this.registerErrorState(null),sharedState.error=null,sharedState.resolver=null,this.resolveModule()}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){var e=this,t=d.module,n=d.error;if(n)return c?React__default.createElement(c,_extends({retry:function(){return e.retryResolvingModule()}},this.props,{error:n})):null;var o,r=(o=t,i&&null!=o&&("function"==typeof o||"object"===(void 0===o?"undefined":_typeof(o)))&&o.default?o.default:o);return r?React__default.createElement(r,this.props):l?React__default.createElement(l,this.props):null}}]),t}(React__default.Component),t.displayName=o||"AsyncComponent",t.contextTypes={asyncComponentsAncestor:PropTypes.shape({isBoundary:PropTypes.bool}),asyncComponents:PropTypes.shape({getNextId:PropTypes.func.isRequired,resolved:PropTypes.func.isRequired,shouldRehydrate:PropTypes.func.isRequired})},t.childContextTypes={asyncComponentsAncestor:PropTypes.shape({isBoundary:PropTypes.bool})},n}exports.AsyncComponentProvider=AsyncComponentProvider,exports.createAsyncContext=createAsyncContext,exports.asyncComponent=asyncComponent;
//# sourceMappingURL=react-async-component.min.js.map
